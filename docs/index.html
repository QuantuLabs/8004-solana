<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8004 on Solana - Technical Documentation</title>
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-code: #1c2128;
            --border: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-purple: #a371f7;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-orange: #d29922;
            --accent-red: #f85149;
            --accent-cyan: #39c5cf;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .program-ids {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .program-id {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.85rem;
        }

        .program-id .label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            display: block;
            margin-bottom: 0.25rem;
        }

        .program-id.identity { border-left: 3px solid var(--accent-purple); }
        .program-id.reputation { border-left: 3px solid var(--accent-green); }
        .program-id.validation { border-left: 3px solid var(--accent-orange); }

        nav {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 3rem;
            position: sticky;
            top: 1rem;
            z-index: 100;
        }

        nav ul {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            list-style: none;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        nav a:hover {
            background: var(--bg-code);
            color: var(--accent-blue);
        }

        section {
            margin-bottom: 4rem;
        }

        h2 {
            font-size: 2rem;
            color: var(--accent-purple);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }

        h3 {
            font-size: 1.5rem;
            color: var(--accent-blue);
            margin: 2rem 0 1rem;
        }

        h4 {
            font-size: 1.2rem;
            color: var(--accent-cyan);
            margin: 1.5rem 0 0.75rem;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .card-header .icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .icon.purple { background: rgba(163, 113, 247, 0.2); color: var(--accent-purple); }
        .icon.green { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
        .icon.orange { background: rgba(210, 153, 34, 0.2); color: var(--accent-orange); }
        .icon.blue { background: rgba(88, 166, 255, 0.2); color: var(--accent-blue); }

        code {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            background: var(--bg-code);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        pre {
            background: var(--bg-code);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        pre code {
            background: none;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-code);
            color: var(--accent-blue);
            font-weight: 600;
        }

        tr:hover {
            background: rgba(88, 166, 255, 0.05);
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .tag.required { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
        .tag.optional { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
        .tag.signer { background: rgba(163, 113, 247, 0.2); color: var(--accent-purple); }
        .tag.mut { background: rgba(210, 153, 34, 0.2); color: var(--accent-orange); }
        .tag.init { background: rgba(88, 166, 255, 0.2); color: var(--accent-blue); }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .architecture-diagram {
            background: var(--bg-code);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.85rem;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.4;
        }

        .highlight {
            color: var(--accent-green);
        }

        .warning {
            background: rgba(210, 153, 34, 0.1);
            border: 1px solid var(--accent-orange);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .warning::before {
            content: "âš ï¸ ";
        }

        .info {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .info::before {
            content: "â„¹ï¸ ";
        }

        .success {
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .success::before {
            content: "âœ… ";
        }

        .pda-seed {
            background: var(--bg-code);
            border-left: 3px solid var(--accent-purple);
            padding: 0.5rem 1rem;
            margin: 0.5rem 0;
            font-family: monospace;
        }

        .flex-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-green);
        }

        .stat-card .label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        footer {
            text-align: center;
            padding: 3rem 0;
            border-top: 1px solid var(--border);
            margin-top: 4rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            body { padding: 1rem; }
            h1 { font-size: 2rem; }
            nav { position: static; }
            .program-ids { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="version-tabs" style="margin-bottom: 1rem;">
                <a href="v0.1.0.html" style="color: var(--text-secondary); margin-right: 1rem; text-decoration: none;">v0.1.0</a>
                <a href="index.html" style="color: var(--accent-purple); font-weight: bold; text-decoration: none; border-bottom: 2px solid var(--accent-purple); padding-bottom: 2px;">v0.2.0</a>
            </div>
            <h1>8004 on Solana</h1>
            <p class="subtitle">Technical Documentation for AI Agent Identity & Reputation Registry</p>
            <div class="program-ids">
                <div class="program-id identity" style="border-left: 3px solid var(--accent-blue);">
                    <span class="label">AgentRegistry8004 (Devnet)</span>
                    GkC3LyywEPy3LaMr2XUHHKb7XMdd9T2aZ8iohtNGPXJg
                </div>
            </div>
            <p style="color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                Single program with Identity, Reputation & Validation modules | Metaplex Core | 89 tests
            </p>
        </header>

        <nav>
            <ul>
                <li><a href="#changelog">Changelog</a></li>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#identity">Identity</a></li>
                <li><a href="#reputation">Reputation</a></li>
                <li><a href="#validation">Validation</a></li>
                <li><a href="#costs">Costs</a></li>
                <li><a href="#pda-reference">PDA Reference</a></li>
            </ul>
        </nav>

        <!-- CHANGELOG SECTION -->
        <section id="changelog">
            <h2>v0.2.0 Changelog</h2>

            <h3>Architecture</h3>
            <ul>
                <li><strong>Program Consolidation</strong> â€” 3 separate programs (identity, reputation, validation) merged into 1 unified <code>agent_registry_8004</code> program</li>
                <li><strong>Metaplex Core Migration</strong> â€” Migrated from SPL Token + Token Metadata to Metaplex Core (6x cheaper NFT operations, simpler ownership model)</li>
                <li><strong>Global Feedback Index</strong> â€” Simplified PDA derivation (client removed from seeds)</li>
            </ul>

            <h3>New Features</h3>
            <ul>
                <li><strong>Metadata PDAs</strong> â€” Individual PDA per key (replaces Vec), unlimited entries</li>
                <li><strong>Immutable Metadata</strong> â€” Lock metadata permanently for certifications</li>
                <li><strong>Delete Metadata</strong> â€” Recover rent by deleting mutable entries</li>
                <li><strong>Hash-Only Storage</strong> â€” URIs in events, hashes on-chain</li>
                <li><strong>Optional Tags PDA</strong> â€” FeedbackTagsPda for -42% cost when tags not used</li>
            </ul>

            <h3>Account Size Optimizations</h3>
            <ul>
                <li><strong>FeedbackAccount:</strong> 375 â†’ 99 bytes (<strong>-74%</strong>) â€” tags moved to optional PDA</li>
                <li><strong>ResponseAccount:</strong> 309 â†’ 105 bytes (<strong>-66%</strong>)</li>
                <li><strong>AgentAccount:</strong> 661 â†’ ~365 bytes (<strong>-45%</strong>)</li>
            </ul>

            <h3>Breaking Changes</h3>
            <ul>
                <li>3 programs â†’ 1 unified <code>agent_registry_8004</code></li>
                <li>SPL Token NFTs â†’ Metaplex Core assets</li>
                <li><code>file_uri</code> / <code>response_uri</code> removed from accounts (events only)</li>
                <li><code>tag1</code> / <code>tag2</code> moved to optional <code>FeedbackTagsPda</code></li>
                <li><code>set_metadata</code> â†’ <code>set_metadata_pda(key_hash, key, value, immutable)</code></li>
                <li><code>Vec&lt;MetadataEntry&gt;</code> removed from AgentAccount</li>
                <li>MetadataExtension removed (use PDAs instead)</li>
            </ul>
        </section>

        <!-- OVERVIEW SECTION -->
        <section id="overview">
            <h2>Overview</h2>
            <p>8004 is a standard for on-chain AI agent registries. This Solana implementation (v0.2.0) provides a single program with three modules:</p>

            <div class="grid" style="margin-top: 1.5rem;">
                <div class="card">
                    <div class="card-header">
                        <div class="icon purple">ID</div>
                        <h4 style="margin: 0;">Identity Module</h4>
                    </div>
                    <p>NFT-based agent registration with <strong>Metaplex Core</strong>. Each agent gets a unique Core asset as its on-chain identity.</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="icon green">â˜…</div>
                        <h4 style="margin: 0;">Reputation Module</h4>
                    </div>
                    <p>Feedback system with global index, scores (0-100), tags, and responses. Cached aggregates enable O(1) queries.</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="icon orange">âœ“</div>
                        <h4 style="margin: 0;">Validation Module</h4>
                    </div>
                    <p>Third-party validation and attestation. Validators provide scores (0-100) with progressive updates.</p>
                </div>
            </div>

            <div class="flex-row" style="margin-top: 2rem;">
                <div class="stat-card">
                    <div class="value">0.00650</div>
                    <div class="label">SOL per Agent Registration</div>
                </div>
                <div class="stat-card">
                    <div class="value">0.00158</div>
                    <div class="label">SOL per Feedback (2nd+)</div>
                </div>
                <div class="stat-card">
                    <div class="value">-74%</div>
                    <div class="label">FeedbackAccount Size</div>
                </div>
                <div class="stat-card">
                    <div class="value">âˆ</div>
                    <div class="label">Metadata per Agent</div>
                </div>
            </div>
        </section>

        <!-- ARCHITECTURE SECTION -->
        <section id="architecture">
            <h2>Architecture</h2>

            <div class="architecture-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AgentRegistry8004 (Devnet)                               â”‚
â”‚              <span class="highlight">GkC3LyywEPy3LaMr2XUHHKb7XMdd9T2aZ8iohtNGPXJg</span>                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Identity Module  â”‚ â”‚ Reputation Moduleâ”‚ â”‚    Validation Module       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ register()       â”‚ â”‚ â€¢ give_feedback()â”‚ â”‚ â€¢ request_validation()     â”‚ â”‚
â”‚  â”‚ â€¢ set_metadata_pda â”‚ â”‚ â€¢ revoke_feedbackâ”‚ â”‚ â€¢ respond_to_validation()  â”‚ â”‚
â”‚  â”‚ â€¢ delete_meta_pda  â”‚ â”‚ â€¢ append_responseâ”‚ â”‚ â€¢ update_validation()      â”‚ â”‚
â”‚  â”‚ â€¢ set_agent_uri()  â”‚ â”‚                  â”‚ â”‚ â€¢ close_validation()       â”‚ â”‚
â”‚  â”‚ â€¢ transfer_agent() â”‚ â”‚                  â”‚ â”‚                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           METAPLEX CORE                                      â”‚
â”‚  â€¢ Collection created on initialize() as Core Collection                    â”‚
â”‚  â€¢ Agent NFTs are Core Assets verified against collection                   â”‚
â”‚  â€¢ Update authority managed via Config PDA                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
        </section>

        <!-- TOOLS & ECOSYSTEM SECTION -->
        <section id="tools">
            <h2>Tools & Ecosystem</h2>

            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="icon blue">SDK</div>
                        <h4 style="margin: 0;">8004 Solana TypeScript SDK</h4>
                    </div>
                    <p>Official TypeScript SDK for interacting with 8004 programs. Includes PDA derivation, Borsh schemas, and program wrappers.</p>
                    <p style="margin-top: 1rem;">
                        <span class="tag" style="background: rgba(63, 185, 80, 0.2); color: var(--accent-green);">Available</span>
                    </p>
                    <p style="margin-top: 0.75rem;">
                        <a href="https://github.com/QuantuLabs/8004-solana-ts-sdk" style="color: var(--accent-blue);">GitHub Repository â†’</a>
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="icon green">ğŸ”</div>
                        <h4 style="margin: 0;">Agent Explorer</h4>
                    </div>
                    <p>Browse and explore all registered 8004 agents on Solana. View agent metadata, reputation scores, and validation history.</p>
                    <p style="margin-top: 1rem;">
                        <span class="tag" style="background: rgba(63, 185, 80, 0.2); color: var(--accent-green);">Available</span>
                    </p>
                    <p style="margin-top: 0.75rem;">
                        <a href="https://x402synthex.xyz/agents/" style="color: var(--accent-blue);">x402synthex.xyz/agents â†’</a>
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="icon purple">UI</div>
                        <h4 style="margin: 0;">Agent Creation Tool</h4>
                    </div>
                    <p>Web interface for creating and managing 8004 agents. No-code solution for registering AI agents on Solana.</p>
                    <p style="margin-top: 1rem;">
                        <span class="tag" style="background: rgba(163, 113, 247, 0.2); color: var(--accent-purple);">Launching This Week</span>
                    </p>
                    <p style="margin-top: 0.75rem;">
                        <a href="https://x402synthex.xyz/create-agent/" style="color: var(--accent-blue);">x402synthex.xyz/create-agent â†’</a>
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="icon orange">IDX</div>
                        <h4 style="margin: 0;">8004 Indexer</h4>
                    </div>
                    <p>Off-chain indexer for 8004 events and account data. Enables fast queries for agent reputation, feedback history, and validation status.</p>
                    <p style="margin-top: 1rem;">
                        <span class="tag" style="background: rgba(210, 153, 34, 0.2); color: var(--accent-orange);">In Development</span>
                        <span style="color: var(--text-secondary); font-size: 0.85rem; margin-left: 0.5rem;">Expected: December 2025</span>
                    </p>
                </div>
            </div>
        </section>

        <!-- IDENTITY MODULE SECTION -->
        <section id="identity">
            <h2>Identity Module</h2>
            <p>Manages agent registration with NFT-based identity. Each agent is represented by a unique <strong>Metaplex Core</strong> asset.</p>

            <h3>Key Design: Permissionless Registration</h3>
            <div class="info">
                Anyone can register agents without requiring deployer signature. The program's <strong>Collection Authority PDA</strong> signs for Metaplex collection verification via <code>invoke_signed()</code>.
            </div>

            <h3>Instructions</h3>

            <!-- initialize -->
            <div class="card">
                <h4>initialize()</h4>
                <p>Initialize the registry and create the Metaplex Core Collection.</p>

                <p><strong>What it does:</strong></p>
                <ul>
                    <li>Creates <code>Config</code> PDA with global state</li>
                    <li>Creates Metaplex Core Collection</li>
                    <li><strong>Config PDA becomes collection update_authority</strong> (enables permissionless registration)</li>
                </ul>

                <p><strong>Accounts:</strong></p>
                <table>
                    <tr><th>Account</th><th>Type</th><th>Description</th></tr>
                    <tr><td>config</td><td><span class="tag init">init</span> <span class="tag mut">mut</span></td><td>PDA: <code>["config"]</code></td></tr>
                    <tr><td>collection</td><td><span class="tag init">init</span></td><td>Core Collection asset</td></tr>
                    <tr><td>authority</td><td><span class="tag signer">signer</span></td><td>Registry deployer</td></tr>
                </table>
            </div>

            <!-- register -->
            <div class="card">
                <h4>register(agent_uri: String) / register_empty()</h4>
                <p>Register a new agent with optional URI.</p>

                <p><strong>Parameters:</strong></p>
                <table>
                    <tr><th>Param</th><th>Type</th><th>Constraint</th></tr>
                    <tr><td>agent_uri</td><td>String</td><td>Max 200 bytes (or empty for register_empty)</td></tr>
                </table>

                <p><strong>Flow:</strong></p>
                <ol>
                    <li>Increment <code>config.next_agent_id</code> (sequential u64)</li>
                    <li>Create Metaplex Core asset with collection plugin</li>
                    <li><strong>Add to collection via Config PDA signature</strong></li>
                    <li>Initialize AgentAccount PDA keyed by Core asset</li>
                </ol>

                <div class="pda-seed">
                    <strong>Agent PDA:</strong> seeds = ["agent", asset.key()]
                </div>

                <p><strong>Events:</strong> <code>Registered</code></p>
            </div>

            <!-- set_metadata_pda -->
            <div class="card">
                <h4>set_metadata_pda(key_hash, key, value, immutable)</h4>
                <p>Create or update a metadata entry as individual PDA. Only Core asset holder can call.</p>

                <p><strong>Parameters:</strong></p>
                <table>
                    <tr><th>Param</th><th>Type</th><th>Description</th></tr>
                    <tr><td>key_hash</td><td>[u8; 8]</td><td>First 8 bytes of SHA256(key)</td></tr>
                    <tr><td>key</td><td>String</td><td>Max 32 bytes</td></tr>
                    <tr><td>value</td><td>Vec&lt;u8&gt;</td><td>Max 256 bytes</td></tr>
                    <tr><td>immutable</td><td>bool</td><td>If true, cannot modify/delete later</td></tr>
                </table>

                <div class="pda-seed">
                    <strong>Metadata PDA:</strong> seeds = ["agent_meta", agent_id, key_hash[0..8]]
                </div>

                <div class="warning">
                    Once <code>immutable: true</code>, the entry is permanently locked.
                </div>
            </div>

            <!-- delete_metadata_pda -->
            <div class="card">
                <h4>delete_metadata_pda(key_hash)</h4>
                <p>Delete a metadata PDA and recover rent. Only works if not immutable.</p>

                <p><strong>Parameters:</strong></p>
                <table>
                    <tr><th>Param</th><th>Type</th><th>Description</th></tr>
                    <tr><td>key_hash</td><td>[u8; 8]</td><td>First 8 bytes of SHA256(key)</td></tr>
                </table>

                <p><strong>Returns:</strong> ~0.0031 SOL rent to owner</p>

                <p><strong>Events:</strong> <code>MetadataDeleted</code></p>
            </div>

            <!-- set_agent_uri -->
            <div class="card">
                <h4>set_agent_uri(new_uri: String)</h4>
                <p>Update agent URI and sync to Metaplex Core asset.</p>
                <p>Uses <code>UpdateV1CpiBuilder</code> to update Core asset URI. Config PDA signs as collection update authority.</p>
            </div>

            <!-- transfer_agent -->
            <div class="card">
                <h4>transfer_agent()</h4>
                <p>Transfer Core asset to new owner. Uses <code>TransferV1CpiBuilder</code> for Metaplex Core transfer.</p>
            </div>

            <h3>Account Structures</h3>

            <div class="card">
                <h4>Config</h4>
                <pre><code>pub struct Config {
    pub authority: Pubkey,              // 32 bytes
    pub next_agent_id: u64,             // 8 bytes (sequential counter)
    pub total_agents: u64,              // 8 bytes
    pub collection: Pubkey,             // 32 bytes (Core Collection)
    pub bump: u8,                       // 1 byte
}</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["config"]</div>
            </div>

            <div class="card">
                <h4>AgentAccount (~365 bytes)</h4>
                <pre><code>pub struct AgentAccount {
    pub agent_id: u64,                  // 8 bytes
    pub owner: Pubkey,                  // 32 bytes (cached)
    pub asset: Pubkey,                  // 32 bytes (Core asset)
    pub agent_uri: String,              // 4 + 200 = 204 bytes
    pub nft_name: String,               // 4 + 32 = 36 bytes ("Agent #X")
    pub nft_symbol: String,             // 4 + 10 = 14 bytes
    // Metadata moved to individual PDAs (v0.2.0)
    pub created_at: i64,                // 8 bytes
    pub bump: u8,                       // 1 byte
}

// Constants
MAX_URI_LENGTH: 200</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["agent", asset.key()]</div>
            </div>

            <div class="card">
                <h4>MetadataEntryPda (~330 bytes) - NEW in v0.2.0</h4>
                <pre><code>pub struct MetadataEntryPda {
    pub agent_id: u64,              // 8 bytes
    pub metadata_key: String,       // 4 + 32 = 36 bytes
    pub metadata_value: Vec&lt;u8&gt;,    // 4 + 256 = 260 bytes
    pub immutable: bool,            // 1 byte (if true, locked forever)
    pub created_at: i64,            // 8 bytes
    pub bump: u8,                   // 1 byte
}

// Unlimited metadata per agent via individual PDAs
// Delete to recover rent (~0.0031 SOL)</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["agent_meta", agent_id (LE), key_hash[0..8]]</div>
            </div>

            <h3>Error Codes</h3>
            <table>
                <tr><th>Error</th><th>Message</th><th>Condition</th></tr>
                <tr><td>UriTooLong</td><td>"URI&gt;200"</td><td>agent_uri exceeds 200 bytes</td></tr>
                <tr><td>KeyTooLong</td><td>"Key&gt;32"</td><td>metadata key exceeds 32 bytes</td></tr>
                <tr><td>ValueTooLong</td><td>"Val&gt;256"</td><td>metadata value exceeds 256 bytes</td></tr>
                <tr><td>MetadataImmutable</td><td>"Immutable"</td><td>Cannot modify/delete immutable metadata</td></tr>
                <tr><td>Unauthorized</td><td>"!owner"</td><td>Caller is not agent owner</td></tr>
                <tr><td>Overflow</td><td>"Overflow"</td><td>Agent ID counter overflowed</td></tr>
                <tr><td>InvalidTokenAccount</td><td>"!NFT"</td><td>Token account doesn't hold the NFT</td></tr>
            </table>

            <h3>Events</h3>
            <table>
                <tr><th>Event</th><th>Fields</th><th>Emitted</th></tr>
                <tr><td>Registered</td><td>agent_id, agent_uri, owner, agent_mint</td><td>register()</td></tr>
                <tr><td>MetadataSet</td><td>agent_id, indexed_key, key, value, <strong>immutable</strong></td><td>set_metadata_pda()</td></tr>
                <tr><td>MetadataDeleted</td><td>agent_id, key</td><td>delete_metadata_pda()</td></tr>
                <tr><td>UriUpdated</td><td>agent_id, new_uri, updated_by</td><td>set_agent_uri()</td></tr>
                <tr><td>AgentOwnerSynced</td><td>agent_id, old_owner, new_owner, agent_mint</td><td>sync_owner(), transfer_agent()</td></tr>
            </table>
        </section>

        <!-- REPUTATION MODULE SECTION -->
        <section id="reputation">
            <h2>Reputation Module</h2>
            <p>Manages feedback, responses, and cached reputation aggregates for agents.</p>

            <h3>Key Design: Cached Aggregates</h3>
            <div class="success">
                <strong>O(1) Reputation Queries:</strong> The <code>AgentReputationMetadata</code> account stores pre-calculated aggregates (total_feedbacks, total_score_sum, average_score). Updated atomically on every give/revoke.
            </div>

            <h3>Instructions</h3>

            <!-- give_feedback -->
            <div class="card">
                <h4>give_feedback(agent_id, score, tag1, tag2, file_uri, file_hash)</h4>
                <p>Create feedback for an agent. Updates cached reputation stats.</p>

                <p><strong>Parameters:</strong></p>
                <table>
                    <tr><th>Param</th><th>Type</th><th>Constraint</th></tr>
                    <tr><td>agent_id</td><td>u64</td><td>Must exist (validated internally)</td></tr>
                    <tr><td>score</td><td>u8</td><td>0-100 (validated on-chain)</td></tr>
                    <tr><td>tag1, tag2</td><td>String</td><td>Max 32 bytes each</td></tr>
                    <tr><td>file_uri</td><td>String</td><td>Max 200 bytes</td></tr>
                    <tr><td>file_hash</td><td>[u8; 32]</td><td>SHA-256 hash</td></tr>
                </table>

                <p><strong>Global Feedback Index:</strong></p>
                <pre><code>// Index auto-incremented from AgentReputationMetadata
let feedback_index = agent_reputation.next_feedback_index;
agent_reputation.next_feedback_index += 1;</code></pre>

                <p><strong>Aggregate Update:</strong></p>
                <pre><code>agent_reputation.total_feedbacks += 1;
agent_reputation.total_score_sum += score as u64;
agent_reputation.average_score = min(total_score_sum / total_feedbacks, 100);</code></pre>

                <div class="pda-seed">
                    <strong>Feedback PDA:</strong> seeds = ["feedback", agent_id (LE), feedback_index (LE)]
                </div>
            </div>

            <!-- revoke_feedback -->
            <div class="card">
                <h4>revoke_feedback(agent_id, feedback_index)</h4>
                <p>Mark feedback as revoked (preserves audit trail). Only original author can revoke.</p>

                <p><strong>State Changes:</strong></p>
                <ul>
                    <li><code>feedback.is_revoked = true</code></li>
                    <li><code>agent_reputation.total_feedbacks -= 1</code></li>
                    <li><code>agent_reputation.total_score_sum -= feedback.score</code></li>
                    <li>Recalculates average_score</li>
                </ul>
            </div>

            <!-- append_response -->
            <div class="card">
                <h4>append_response(agent_id, feedback_index, response_uri, response_hash)</h4>
                <p>Append response to existing feedback. <strong>Anyone can respond</strong> (permissionless).</p>

                <p><strong>Use Cases:</strong></p>
                <ul>
                    <li>Agent showing refund/resolution</li>
                    <li>Data aggregator flagging spam</li>
                    <li>Community providing context</li>
                </ul>

                <div class="pda-seed">
                    <strong>Response PDA:</strong> seeds = ["response", agent_id (LE), feedback_index (LE), response_index (LE)]
                </div>
                <p><em>Unlimited responses per feedback via ResponseIndexAccount tracking.</em></p>
            </div>

            <h3>Account Structures</h3>

            <div class="card">
                <h4>FeedbackAccount (99 bytes) - Optimized in v0.2.0</h4>
                <pre><code>pub struct FeedbackAccount {
    pub agent_id: u64,           // 8 bytes
    pub client_address: Pubkey,  // 32 bytes (who gave feedback)
    pub feedback_index: u64,     // 8 bytes (global index)
    pub score: u8,               // 1 byte (0-100)
    // tag1/tag2 moved to FeedbackTagsPda (optional)
    // file_uri removed - stored in NewFeedback event only
    pub file_hash: [u8; 32],     // 32 bytes
    pub is_revoked: bool,        // 1 byte
    pub created_at: i64,         // 8 bytes
    pub bump: u8,                // 1 byte
}
// -74% size reduction vs v0.1.0 (was 375 bytes)</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["feedback", agent_id (LE), feedback_index (LE)]</div>
                <div class="info" style="margin-top: 0.5rem;">
                    Tags in optional FeedbackTagsPda for <code>getProgramAccounts</code> filtering. URIs in events.
                </div>
            </div>

            <div class="card">
                <h4>FeedbackTagsPda (97 bytes) - Optional</h4>
                <pre><code>pub struct FeedbackTagsPda {
    pub agent_id: u64,           // 8 bytes
    pub feedback_index: u64,     // 8 bytes
    pub tag1: String,            // 4 + 32 = 36 bytes
    pub tag2: String,            // 4 + 32 = 36 bytes
    pub bump: u8,                // 1 byte
}
// Created only when tags are set via setFeedbackTags</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["feedback_tags", agent_id (LE), feedback_index (LE)]</div>
                <div class="info" style="margin-top: 0.5rem;">
                    Use <code>setFeedbackTags</code> after <code>giveFeedback</code> to add tags on-chain.
                    Tags always included in NewFeedback event for indexers.
                </div>
            </div>

            <div class="card">
                <h4>AgentReputationMetadata - Cached Stats</h4>
                <pre><code>pub struct AgentReputationMetadata {
    pub agent_id: u64,              // 8 bytes
    pub total_feedbacks: u64,       // 8 bytes (non-revoked count)
    pub total_score_sum: u64,       // 8 bytes (for precise average)
    pub average_score: u8,          // 1 byte (0-100, pre-calculated)
    pub next_feedback_index: u64,   // 8 bytes (global counter)
    pub last_updated: i64,          // 8 bytes
    pub bump: u8,                   // 1 byte
}</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["agent_reputation", agent_id (LE)]</div>
            </div>

            <div class="card">
                <h4>ResponseAccount (105 bytes) - Optimized in v0.2.0</h4>
                <pre><code>pub struct ResponseAccount {
    pub agent_id: u64,           // 8 bytes
    pub feedback_index: u64,     // 8 bytes
    pub response_index: u64,     // 8 bytes
    pub responder: Pubkey,       // 32 bytes
    // response_uri removed - stored in ResponseAppended event only (v0.2.0)
    pub response_hash: [u8; 32], // 32 bytes
    pub created_at: i64,         // 8 bytes
    pub bump: u8,                // 1 byte
}
// -66% size reduction vs v0.1.0 (was 309 bytes)</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["response", agent_id (LE), feedback_index (LE), response_index (LE)]</div>
            </div>

            <div class="card">
                <h4>ResponseIndexAccount</h4>
                <p>Tracks next response index per feedback. Enables unlimited responses.</p>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["response_index", agent_id (LE), feedback_index (LE)]</div>
            </div>

            <h3>Error Codes</h3>
            <table>
                <tr><th>Error</th><th>Message</th><th>Condition</th></tr>
                <tr><td>InvalidScore</td><td>"Score[0-100]"</td><td>score &gt; 100</td></tr>
                <tr><td>UriTooLong</td><td>"URI&gt;200"</td><td>file_uri exceeds 200 bytes</td></tr>
                <tr><td>Unauthorized</td><td>"!author"</td><td>Non-author attempts revoke</td></tr>
                <tr><td>AlreadyRevoked</td><td>"Revoked"</td><td>Already revoked</td></tr>
                <tr><td>AgentNotFound</td><td>"!Agent"</td><td>Agent doesn't exist in Identity Registry</td></tr>
                <tr><td>InvalidFeedbackIndex</td><td>"!FbIdx"</td><td>Index mismatch</td></tr>
                <tr><td>InvalidIdentityRegistry</td><td>"!IdReg"</td><td>Wrong Identity Registry program</td></tr>
            </table>

            <h3>Events (Store URIs in v0.2.0)</h3>
            <table>
                <tr><th>Event</th><th>Fields</th></tr>
                <tr><td>NewFeedback</td><td>agent_id, client_address, feedback_index, score, tag1, tag2, <strong>file_uri</strong>, file_hash</td></tr>
                <tr><td>FeedbackRevoked</td><td>agent_id, client_address, feedback_index</td></tr>
                <tr><td>ResponseAppended</td><td>agent_id, client_address, feedback_index, response_index, responder, <strong>response_uri</strong>, response_hash</td></tr>
            </table>
            <div class="info" style="margin-top: 0.5rem;">
                <strong>v0.2.0:</strong> URIs stored in events only (not on-chain). Parse transaction logs to retrieve URIs.
            </div>
        </section>

        <!-- VALIDATION MODULE SECTION -->
        <section id="validation">
            <h2>Validation Module</h2>
            <p>Third-party validation and attestation system. Validators can provide scores with progressive updates.</p>

            <h3>Key Design: Cost-Optimized Storage</h3>
            <div class="success">
                <strong>75% Cost Savings:</strong> URIs stored in events only (not on-chain). ValidationRequest is only 126 bytes vs ~590 bytes with URIs.
            </div>

            <h3>Instructions</h3>

            <!-- request_validation -->
            <div class="card">
                <h4>request_validation(agent_id, validator_address, nonce, request_uri, request_hash)</h4>
                <p>Request validation for an agent. Only NFT holder can request.</p>

                <p><strong>Parameters:</strong></p>
                <table>
                    <tr><th>Param</th><th>Type</th><th>Description</th></tr>
                    <tr><td>agent_id</td><td>u64</td><td>Agent to validate</td></tr>
                    <tr><td>validator_address</td><td>Pubkey</td><td>Who can respond</td></tr>
                    <tr><td>nonce</td><td>u32</td><td>Sequence number (enables multiple validations from same validator)</td></tr>
                    <tr><td>request_uri</td><td>String</td><td>Max 200 bytes (stored in event only)</td></tr>
                    <tr><td>request_hash</td><td>[u8; 32]</td><td>SHA-256 hash (stored on-chain)</td></tr>
                </table>

                <div class="pda-seed">
                    <strong>ValidationRequest PDA:</strong> seeds = ["validation", agent_id (LE), validator_address, nonce (LE)]
                </div>
            </div>

            <!-- respond_to_validation -->
            <div class="card">
                <h4>respond_to_validation(response, response_uri, response_hash, tag)</h4>
                <p>Validator responds to validation request. Only designated validator can respond.</p>

                <p><strong>Parameters:</strong></p>
                <table>
                    <tr><th>Param</th><th>Type</th><th>Description</th></tr>
                    <tr><td>response</td><td>u8</td><td>0-100 (0=failed, 100=passed)</td></tr>
                    <tr><td>response_uri</td><td>String</td><td>Max 200 bytes (stored in event)</td></tr>
                    <tr><td>response_hash</td><td>[u8; 32]</td><td>SHA-256 hash</td></tr>
                    <tr><td>tag</td><td>String</td><td>Max 32 bytes (e.g., "oasf-v0.8.0", "zkml-verified")</td></tr>
                </table>
            </div>

            <!-- update_validation -->
            <div class="card">
                <h4>update_validation(...) - Progressive Validation</h4>
                <p>Same as respond_to_validation. Allows validators to update scores as agents improve.</p>
            </div>

            <!-- close_validation -->
            <div class="card">
                <h4>close_validation()</h4>
                <p>Close validation request to recover rent. Only agent owner or program authority can close.</p>
            </div>

            <h3>Account Structures</h3>

            <div class="card">
                <h4>ValidationConfig (81 bytes)</h4>
                <pre><code>pub struct ValidationConfig {
    pub authority: Pubkey,           // 32 bytes
    pub identity_registry: Pubkey,   // 32 bytes
    pub total_requests: u64,         // 8 bytes
    pub total_responses: u64,        // 8 bytes
    pub bump: u8,                    // 1 byte
}</code></pre>
                <div class="pda-seed"><strong>PDA:</strong> seeds = ["config"]</div>
            </div>

            <div class="card">
                <h4>ValidationRequest (126 bytes) - Cost Optimized</h4>
                <pre><code>pub struct ValidationRequest {
    pub agent_id: u64,               // 8 bytes
    pub validator_address: Pubkey,   // 32 bytes
    pub nonce: u32,                  // 4 bytes
    pub request_hash: [u8; 32],      // 32 bytes
    pub response_hash: [u8; 32],     // 32 bytes (empty until response)
    pub response: u8,                // 1 byte (0-100)
    pub created_at: i64,             // 8 bytes
    pub responded_at: i64,           // 8 bytes (0 if pending)
    pub bump: u8,                    // 1 byte
}

// Helper methods
pub fn has_response(&self) -> bool { self.responded_at > 0 }
pub fn is_pending(&self) -> bool { self.responded_at == 0 }</code></pre>
            </div>

            <h3>Error Codes</h3>
            <table>
                <tr><th>Error</th><th>Message</th><th>Condition</th></tr>
                <tr><td>RequestUriTooLong</td><td>"ReqURI&gt;200"</td><td>Request URI exceeds 200 bytes</td></tr>
                <tr><td>ResponseUriTooLong</td><td>"RespURI&gt;200"</td><td>Response URI exceeds 200 bytes</td></tr>
                <tr><td>InvalidResponse</td><td>"Resp[0-100]"</td><td>Response not in 0-100 range</td></tr>
                <tr><td>UnauthorizedValidator</td><td>"!Validator"</td><td>Not the designated validator</td></tr>
                <tr><td>UnauthorizedRequester</td><td>"!Owner"</td><td>Not the NFT holder</td></tr>
                <tr><td>AgentNotFound</td><td>"!Agent"</td><td>Agent doesn't exist</td></tr>
                <tr><td>InvalidIdentityRegistry</td><td>"!IdReg"</td><td>Wrong Identity Registry</td></tr>
            </table>

            <h3>Events</h3>
            <table>
                <tr><th>Event</th><th>Fields</th></tr>
                <tr><td>ValidationRequested</td><td>agent_id, validator_address, nonce, request_uri, request_hash, requester, created_at</td></tr>
                <tr><td>ValidationResponded</td><td>agent_id, validator_address, nonce, response, response_uri, response_hash, tag, responded_at</td></tr>
            </table>
        </section>

        <!-- SECURITY SECTION -->
        <section id="security">
            <h2>Security</h2>
            <p>Security mechanisms in the unified program architecture.</p>

            <div class="card">
                <h4>Agent Existence Verification</h4>
                <p>Reputation and Validation modules verify agent existence internally by checking the AgentAccount PDA exists before processing.</p>
                <pre><code>// Agent PDA must exist and match agent_id
#[account(
    seeds = [b"agent", asset.key().as_ref()],
    bump = agent_account.bump,
    constraint = agent_account.agent_id == agent_id
)]
pub agent_account: Account&lt;'info, AgentAccount&gt;,</code></pre>
            </div>

            <div class="card">
                <h4>Ownership Verification (Metaplex Core)</h4>
                <p>For metadata/URI updates, ownership verified via Core asset directly:</p>
                <pre><code>// Core asset stores owner in its data
constraint = asset.owner == owner.key()</code></pre>
                <p><strong>Why:</strong> Metaplex Core assets store owner directly, simplifying ownership verification.</p>
            </div>

            <div class="card">
                <h4>Feedback Authorization</h4>
                <p>Only the original feedback author can revoke:</p>
                <pre><code>constraint = feedback.client_address == client.key()
    @ ReputationError::Unauthorized</code></pre>
            </div>

            <div class="card">
                <h4>Validation Authorization</h4>
                <p>Only the designated validator can respond:</p>
                <pre><code>constraint = validation_request.validator_address == validator.key()
    @ ValidationError::UnauthorizedValidator</code></pre>
            </div>
        </section>

        <!-- COSTS SECTION -->
        <section id="costs">
            <h2>Cost Analysis (v0.2.0)</h2>

            <h3>Operation Costs (Measured on Devnet)</h3>
            <table>
                <tr><th>Operation</th><th>Cost (SOL)</th><th>Lamports</th><th>Notes</th></tr>
                <tr><td>Register Agent</td><td><strong>0.00650</strong></td><td>6,500,320</td><td>Core asset + AgentAccount</td></tr>
                <tr><td>Set Metadata (1st)</td><td><strong>0.00319</strong></td><td>3,192,680</td><td>+MetadataEntryPda</td></tr>
                <tr><td>Set Metadata (update)</td><td>0.000005</td><td>5,000</td><td>TX fee only</td></tr>
                <tr><td>Give Feedback (1st)</td><td>0.00282</td><td>2,823,800</td><td>+AgentReputation init</td></tr>
                <tr><td>Give Feedback (2nd+)</td><td>0.00158</td><td>1,584,920</td><td>FeedbackAccount only</td></tr>
                <tr><td>Append Response (1st)</td><td>0.00275</td><td>2,747,240</td><td>+ResponseIndex init</td></tr>
                <tr><td>Append Response (2nd+)</td><td>0.00163</td><td>1,626,680</td><td>ResponseAccount only</td></tr>
                <tr><td>Revoke Feedback</td><td>0.000005</td><td>5,000</td><td>TX fee only</td></tr>
                <tr><td>Request Validation</td><td>0.00183</td><td>1,828,520</td><td>ValidationRequest</td></tr>
                <tr><td>Respond Validation</td><td>0.000005</td><td>5,000</td><td>TX fee only</td></tr>
                <tr><td><strong>Full Lifecycle</strong></td><td><strong>0.0235</strong></td><td>23,511,840</td><td>Complete test cycle</td></tr>
            </table>

            <h3>First vs Subsequent Savings</h3>
            <table>
                <tr><th>Operation</th><th>1st Call</th><th>2nd+ Calls</th><th>Savings</th></tr>
                <tr><td>Set Metadata</td><td>0.00319 SOL</td><td>0.000005 SOL</td><td class="highlight"><strong>-99%</strong></td></tr>
                <tr><td>Give Feedback</td><td>0.00282 SOL</td><td>0.00158 SOL</td><td class="highlight"><strong>-44%</strong></td></tr>
                <tr><td>Append Response</td><td>0.00275 SOL</td><td>0.00163 SOL</td><td class="highlight"><strong>-41%</strong></td></tr>
            </table>

            <h3>v0.2.0 Account Size Optimizations</h3>
            <table>
                <tr><th>Account</th><th>v0.1.0</th><th>v0.2.0</th><th>Savings</th></tr>
                <tr><td>FeedbackAccount</td><td>375 bytes</td><td>99 bytes</td><td class="highlight"><strong>-74%</strong></td></tr>
                <tr><td>ResponseAccount</td><td>309 bytes</td><td>105 bytes</td><td class="highlight"><strong>-66%</strong></td></tr>
                <tr><td>AgentAccount</td><td>661 bytes</td><td>~365 bytes</td><td class="highlight"><strong>-45%</strong></td></tr>
            </table>
            <p><small>URIs in events only. Tags moved to optional FeedbackTagsPda (97 bytes).</small></p>

            <h3>Cost Optimizations in v0.2.0</h3>

            <div class="card">
                <h4>1. PDA-based Metadata (Unlimited + Deletable)</h4>
                <p><strong>Before:</strong> Vec&lt;MetadataEntry&gt; in AgentAccount (max 1, extensions for more)</p>
                <p><strong>After:</strong> Individual MetadataEntryPda per key (~330 bytes each)</p>
                <p><strong>Benefits:</strong></p>
                <ul>
                    <li>Unlimited metadata entries per agent</li>
                    <li>Delete to recover rent (~0.0031 SOL)</li>
                    <li>Optional immutable flag for certifications</li>
                </ul>
            </div>

            <div class="card">
                <h4>2. Hash-Only Storage + Optional Tags (-74% to -66%)</h4>
                <p><strong>file_uri / response_uri:</strong> Removed from accounts, stored in events only</p>
                <p><strong>tag1 / tag2:</strong> Moved to optional FeedbackTagsPda (97 bytes)</p>
                <p><strong>Savings:</strong></p>
                <ul>
                    <li>FeedbackAccount: 375 â†’ 99 bytes (-74%)</li>
                    <li>ResponseAccount: 309 â†’ 105 bytes (-66%)</li>
                </ul>
                <p>Use <code>setFeedbackTags</code> after <code>giveFeedback</code> to add tags on-chain for <code>getProgramAccounts</code> filtering.</p>
            </div>

            <div class="card">
                <h4>3. Rent Recovery</h4>
                <p>Accounts can be closed to recover rent:</p>
                <ul>
                    <li><code>delete_metadata_pda()</code> - Returns ~0.0031 SOL per entry</li>
                    <li><code>close_validation()</code> - Returns rent to agent owner</li>
                    <li>Effectively "free" storage for temporary data</li>
                </ul>
            </div>
        </section>

        <!-- PDA REFERENCE SECTION -->
        <section id="pda-reference">
            <h2>PDA Reference</h2>

            <h3>Identity Module PDAs</h3>
            <table>
                <tr><th>Account</th><th>Seeds</th></tr>
                <tr><td>Config</td><td><code>["config"]</code></td></tr>
                <tr><td>Agent</td><td><code>["agent", asset.key()]</code></td></tr>
                <tr><td>Metadata Entry (v0.2.0)</td><td><code>["agent_meta", agent_id (LE), key_hash[0..8]]</code></td></tr>
            </table>

            <h3>Reputation Module PDAs</h3>
            <table>
                <tr><th>Account</th><th>Seeds</th></tr>
                <tr><td>Agent Reputation</td><td><code>["agent_reputation", agent_id (LE)]</code></td></tr>
                <tr><td>Feedback</td><td><code>["feedback", agent_id (LE), feedback_index (LE)]</code></td></tr>
                <tr><td>Response</td><td><code>["response", agent_id (LE), feedback_index (LE), response_index (LE)]</code></td></tr>
                <tr><td>Response Index</td><td><code>["response_index", agent_id (LE), feedback_index (LE)]</code></td></tr>
            </table>

            <h3>Validation Module PDAs</h3>
            <table>
                <tr><th>Account</th><th>Seeds</th></tr>
                <tr><td>Validation Request</td><td><code>["validation", agent_id (LE), validator_address, nonce (LE)]</code></td></tr>
            </table>

            <h3>Metaplex Core (External)</h3>
            <table>
                <tr><th>Account</th><th>Description</th></tr>
                <tr><td>Collection</td><td>Core Collection asset (stored in config.collection)</td></tr>
                <tr><td>Asset</td><td>Core Asset for each agent (stored in agent.asset)</td></tr>
            </table>
        </section>

        <footer>
            <p>8004 Solana Implementation - Technical Documentation</p>
            <p>Generated: December 2025 | Programs deployed on Devnet</p>
            <p style="margin-top: 1rem;">
                <a href="https://eips.ethereum.org/EIPS/eip-8004" style="color: var(--accent-blue);">8004 Spec</a> Â·
                <a href="https://github.com/QuantuLabs/8004-solana" style="color: var(--accent-blue);">GitHub Repository</a>
            </p>
        </footer>
    </div>
</body>
</html>
